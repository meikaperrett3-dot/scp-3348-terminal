<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Foundation Global Terminal // SCP-3348</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        body { background-color: #050505; color: #33ff33; font-family: 'Consolas', monospace; padding: 20px; }
        .terminal { max-width: 950px; margin: 0 auto; border: 1px solid #333; background: #000; padding: 20px; border-radius: 5px; box-shadow: 0 0 20px #0a0; }
        .module { background: #111; border: 1px solid #222; padding: 15px; margin-bottom: 20px; }
        .label { color: #a00; font-weight: bold; font-size: 0.8rem; text-transform: uppercase; display: block; margin-bottom: 5px; }
        input, textarea { width: 100%; background: #000; border: 1px solid #444; color: #0f0; padding: 8px; margin-bottom: 10px; box-sizing: border-box; font-family: inherit; }
        .btn-red { background: #a00; color: white; border: none; padding: 10px; cursor: pointer; font-weight: bold; width: 100%; text-transform: uppercase; }
        .btn-grey { background: #333; color: white; border: none; padding: 10px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 5px; }
        .hidden { display: none; }
        .rank-tag { padding: 2px 8px; border-radius: 3px; font-size: 0.7rem; font-weight: bold; margin-left: 10px; }
        .owner { background: gold; color: black; }
    </style>
</head>
<body onload="init()">

<div class="terminal">
    <div id="authPanel" class="module">
        <span class="label">SCiPNET GLOBAL LOGIN</span>
        <input type="email" id="emailInput" placeholder="Email...">
        <input type="text" id="userInput" placeholder="Username (New Accounts)...">
        <input type="password" id="passInput" placeholder="Access Code...">
        <div style="display:flex; gap:10px;">
            <button class="btn-grey" onclick="login()">LOGIN</button>
            <button class="btn-grey" onclick="register()">REQUEST ACCESS</button>
        </div>
    </div>

    <div id="mainInterface" class="hidden">
        <div style="border-bottom: 2px solid #a00; margin-bottom: 15px; padding-bottom: 10px;">
            <span style="font-weight:bold;">OPERATOR:</span> <span id="displayUser"></span>
            <span id="displayRank" class="rank-tag"></span>
            <button onclick="logout()" style="float:right;">DISCONNECT</button>
        </div>

        <div class="module">
            <span class="label">Global Database Search</span>
            <input type="text" id="searchBox" placeholder="Input concept..." onkeypress="if(event.key==='Enter') searchGlobal()">
            <button class="btn-red" onclick="searchGlobal()">SEARCH SITE ARCHIVE</button>
        </div>

        <div id="ownerPanel" class="module hidden" style="border: 1px solid gold;">
            <span class="label" style="color:gold;">O5 COMMAND: PENDING REQUESTS</span>
            <div id="pendingList" style="font-size:0.8rem;">Scanning for new personnel...</div>
        </div>

        <div id="creatorPanel" class="module hidden">
            <span class="label">Add Secure Discovery Log</span>
            <input type="text" id="newWord" placeholder="Subject">
            <input type="text" id="newKaej" placeholder="Kaej String">
            <textarea id="newRes" placeholder="Full Log Data..."></textarea>
            <button class="btn-red" onclick="saveToGlobal()">UPLOAD TO SITE ARCHIVE</button>
        </div>
    </div>
</div>

<script>
    // These keys were copied directly from your Firebase screenshot image_1604a5.png
    const firebaseConfig = {
      apiKey: "AIzaSyD5faeFWtB_Ik0WUaf9umdWs6zTFb_VGQI",
      authDomain: "scp-terminal-dcb35.firebaseapp.com",
      databaseURL: "https://scp-terminal-dcb35-default-rtdb.firebaseio.com",
      projectId: "scp-terminal-dcb35",
      storageBucket: "scp-terminal-dcb35.firebasestorage.app",
      messagingSenderId: "610931653710",
      appId: "1:610931653710:web:a9776d0d1d40de49d7971f",
      measurementId: "G-ZJGVXVYD8"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    const OWNER_EMAIL = "meikaperrett3@gmail.com"; 

    function init() {
        auth.onAuthStateChanged(user => { if(user) checkAccess(user); });
    }

    function register() {
        const email = document.getElementById('emailInput').value;
        const pass = document.getElementById('passInput').value;
        const name = document.getElementById('userInput').value;
        if(!name) return alert("Username required.");

        auth.createUserWithEmailAndPassword(email, pass).then((res) => {
            db.ref('users/' + res.user.uid).set({
                username: name,
                rank: "Researcher",
                approved: false
            });
            alert("REQUEST SUBMITTED. Awaiting Meika's approval.");
            auth.signOut();
        }).catch(err => alert(err.message));
    }

    function login() {
        const email = document.getElementById('emailInput').value;
        const pass = document.getElementById('passInput').value;
        auth.signInWithEmailAndPassword(email, pass).catch(err => alert(err.message));
    }

    function checkAccess(user) {
        db.ref('users/' + user.uid).once('value', (snap) => {
            const data = snap.val();
            if (user.email === OWNER_EMAIL || (data && data.approved)) {
                showInterface(data || {username: "Meika", rank: "Owner"}, user.email);
            } else {
                alert("ACCESS PENDING: Contact Owner for approval.");
                auth.signOut();
            }
        });
    }

    function showInterface(userData, email) {
        document.getElementById('authPanel').classList.add('hidden');
        document.getElementById('mainInterface').classList.remove('hidden');
        document.getElementById('displayUser').innerText = userData.username;
        
        if (email === OWNER_EMAIL) {
            document.getElementById('displayRank').innerText = "OWNER";
            document.getElementById('displayRank').className = "rank-tag owner";
            document.getElementById('ownerPanel').classList.remove('hidden');
            document.getElementById('creatorPanel').classList.remove('hidden');
            loadPending();
        } else {
            document.getElementById('displayRank').innerText = "RESEARCHER";
            document.getElementById('displayRank').className = "rank-tag";
        }
    }

    function loadPending() {
        db.ref('users').on('value', snap => {
            let html = "";
            snap.forEach(child => {
                if (!child.val().approved) {
                    html += `<div>${child.val().username} <button onclick="approveUser('${child.key}')">[APPROVE]</button></div>`;
                }
            });
            document.getElementById('pendingList').innerHTML = html || "No pending requests.";
        });
    }

    function approveUser(uid) { db.ref('users/' + uid).update({ approved: true }); }

    function saveToGlobal() {
        const word = document.getElementById('newWord').value.toLowerCase().trim();
        db.ref('archive/' + word).set({
            kaej: document.getElementById('newKaej').value,
            res: document.getElementById('newRes').value
        }).then(() => alert("SITE ARCHIVE UPDATED."));
    }

    function searchGlobal() {
        const word = document.getElementById('searchBox').value.toLowerCase().trim();
        db.ref('archive/' + word).once('value', snap => {
            if (snap.exists()) {
                alert(`SUCCESS:\nKAEJ: ${snap.val().kaej}\n\nDATA: ${snap.val().res}`);
            } else { alert("LOG NOT FOUND."); }
        });
    }

    function logout() { auth.signOut(); location.reload(); }
</script>
</body>
</html>
